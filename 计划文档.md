# 前端 UI 框架选型（按“好看 + 快做 + 易部署”排序）

## 选型 A（最推荐）：Next.js + Tailwind + shadcn/ui

- **优点**
  - UI 组件成熟、默认就很好看
  - 搜索/筛选/列表/弹窗/表单都很省事
  - 可以静态导出（或纯静态部署），也可带轻量 API
- **部署**
  - 构建后是静态文件 → Nginx 容器托管（最稳）
- **适合**
  - 你要做“像产品一样”的收藏管理网页

------

# UI 页面结构（你这个产品最实用的布局）

## 1) 首页（核心）

- 顶部：搜索框（repo 名/描述/标签）
- 左侧：分类树（一级/二级 + 数量）
- 中间：Repo 卡片流（描述、语言、stars、更新时间、标签）
- 右侧（可选）：筛选面板（语言、多标签、更新时间范围、最小 stars）

## 2) Repo 详情抽屉/弹窗

- README 摘要（可选）
- AI 分类结果（含置信度）
- 手动覆盖（你可以改分类/加标签/移标签）

## 3) 设置页

- GitHub 用户名（单用户时可写死到 env，也可做可配置）
- 同步周期（实际上由 scheduler 决定，这里展示当前 cron）
- 分类体系配置（可上传/编辑 YAML）

------

# Docker Compose 一键部署（最终形态）

仍然是 3 服务（稳、易运维）：

1. `api`：FastAPI（拉取、分类、DB、搜索）
2. `web`：静态前端（Nginx 托管）
3. `scheduler`：cron 定时触发同步

> 你可以做到：`docker compose up -d --build` 后，自动开始按计划同步并更新网页展示。

------

# AI 自动整理分类：落地方案（不烧钱、不跑偏）

## 关键：分两层做（规则优先，AI 兜底）

### 规则层（免费、稳定）

- language → 技术栈维度
- topics → 标签维度
- owner/org → 来源维度

### AI 层（语义分类）

AI 输出你想要的“详细分类”，例如：

- 一级：`tools / music / tv / cloud / dev / ai / data / reading`
- 二级：`download / player / aggregator / scraper / automation / cli ...`
- tags：多标签（bilibili、spotify、alist、iptv、rss、proxy 等）

## 提示词（核心策略）

- 强制输出 JSON
- 强制从你定义的分类体系里选（减少乱飞）
- 给出“置信度”，低置信度的先放 `uncategorized`，再人工覆盖

## 成本控制（必须做）

- **增量**：只对新增/变动 repo 调 AI
   缓存键：`full_name + pushed_at`
- **限额**：每轮最多处理 N 个（防止一夜把额度刷爆）
- **分级**：先不用 README，只有 description 太短/空时再抓 README 摘要

------

# “一键部署 + 自动同步”配置方式（你要的）

## `.env` 里可配置

- `GITHUB_USERNAME`
- `GITHUB_TOKEN`（推荐）
- `AI_PROVIDER / AI_API_KEY / AI_MODEL`
- `SYNC_CRON`（比如每 6 小时）

scheduler 容器启动时把 `SYNC_CRON` 写入 crontab，然后定时 `POST /sync`。

------

# 你的“分类”要做到像 GitHub Lists 一样好用：必须加这项

## ✅ 手动覆盖层（Overrides）

AI 永远会有不准的时候，所以你要提供：

- 强制把某 repo 放到某分类
- 给 repo 加/删标签
- 覆盖结果**不会被下一次同步覆盖**

这是产品体验的关键点。

------

# 最终你会得到的能力（对标你需求）

- ✅ 可部署网页（本地/服务器/VPS都行）
- ✅ Docker Compose 一键启动
- ✅ 定时拉取 GitHub Stars
- ✅ AI 自动分类 + 多标签
- ✅ 搜索 + 筛选 + 分类树展示
- ✅ 手动纠错覆盖（像 GitHub Lists，但更强）
- ✅ key 不泄露（全在后端/环境变量）

------

# 安全性设计

## 认证机制

- **单用户模式**：支持 Basic Auth 或简单密码保护
- **可选 JWT**：如后续扩展多用户，预留 JWT 认证接口

## API 防护

- **Rate Limiting**：限制请求频率，防止滥用
- **CORS 配置**：仅允许指定域名访问 API
- **输入校验**：所有 API 入参做严格校验

## 生产部署

- **HTTPS**：Nginx 配置 SSL 证书（Let's Encrypt 免费）
- **环境变量隔离**：敏感信息不入代码仓库

------

# 数据层设计

## 数据库选型

- **推荐 SQLite**：轻量、零配置、单文件易备份
- **可选 PostgreSQL**：需要全文搜索或多用户时升级

## 数据备份

- **定期备份**：scheduler 容器增加每日备份任务
- **备份位置**：挂载 volume 到宿主机 `./backups/`
- **保留策略**：保留最近 7 天备份，自动清理旧文件

## 数据迁移

- **使用 Alembic**：管理数据库 schema 版本
- **升级脚本**：`docker compose up` 时自动执行迁移

------

# 可观测性

## 日志系统

- **结构化日志**：使用 loguru，输出 JSON 格式
- **日志级别**：通过 `LOG_LEVEL` 环境变量控制
- **日志持久化**：挂载到 `./logs/` 目录

## 健康检查

```yaml
# docker-compose.yml 示例
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
  interval: 30s
  timeout: 10s
  retries: 3
```

## 状态面板

- 前端展示：最近同步时间、同步状态、处理数量
- API 端点：`GET /status` 返回系统运行状态

------

# AI 分类增强

## 容错机制

- **重试策略**：AI 调用失败时指数退避重试（最多 3 次）
- **降级处理**：连续失败则标记为 `uncategorized`，不阻塞流程
- **超时控制**：单次 AI 请求最长 30 秒

## 本地模型备选

- **Ollama 支持**：可配置使用本地模型（完全免费）
- **配置项**：`AI_PROVIDER=ollama`，`OLLAMA_BASE_URL=http://localhost:11434`

## 批量优化

- **合并请求**：多个 repo 描述合并为一次 AI 请求
- **批次大小**：每批最多 10 个，平衡成本与延迟
- **并发控制**：最多 2 个并发 AI 请求

------

# 前端体验增强

## 主题支持

- **暗色模式**：默认跟随系统，可手动切换
- **主题持久化**：存储到 localStorage

## PWA 支持

- **离线访问**：Service Worker 缓存静态资源
- **桌面安装**：支持添加到桌面快捷方式
- **manifest.json**：配置应用图标和启动画面

## 数据导入导出

- **导出**：支持导出分类数据为 JSON/CSV
- **导入**：支持从导出文件恢复分类和覆盖记录
- **用途**：迁移、备份、分享分类体系

## 性能优化

- **虚拟滚动**：星标超过 100 个时启用
- **分页加载**：API 支持分页，前端按需加载
- **图片懒加载**：头像等图片延迟加载

------

# 同步机制增强

## 触发方式

- **定时同步**：cron 表达式配置（默认每 6 小时）
- **手动触发**：前端"立即同步"按钮
- **Webhook（可选）**：GitHub Webhook 实时感知新 star

## 同步日志

- **记录内容**：每次同步的新增/更新/删除数量
- **历史查看**：前端可查看最近 30 次同步记录
- **失败告警**：同步失败时前端提示

## 冲突处理

- **手动覆盖优先**：用户修改的分类不被 AI 覆盖
- **变更检测**：`pushed_at` 变化时重新分类（除非有覆盖）

------

# 扩展性预留

## 多用户支持

- **数据结构**：所有表预留 `user_id` 字段
- **当前实现**：单用户模式，`user_id` 默认为 1
- **未来扩展**：增加用户注册/登录即可支持多用户

## 多平台支持

- **抽象接口**：定义统一的 `StarProvider` 接口
- **GitHub 实现**：当前默认实现
- **扩展预留**：可增加 GitLab、Gitee、Bitbucket 等

## 插件机制（远期）

- **自定义分类规则**：用户可编写简单规则脚本
- **Webhook 通知**：分类完成后可触发外部 Webhook

------

# 开发体验

## 本地开发

- **前端热重载**：Next.js 开发服务器自动刷新
- **后端热重载**：uvicorn --reload 模式
- **docker-compose.dev.yml**：开发专用配置

## API 文档

- **Swagger UI**：访问 `/docs` 查看交互式文档
- **ReDoc**：访问 `/redoc` 查看美化文档
- **OpenAPI 导出**：`/openapi.json` 供前端生成类型

## 调试工具

- **SQL 日志**：开发模式下打印所有 SQL 语句
- **AI 请求日志**：记录完整的 prompt 和 response